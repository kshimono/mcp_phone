# マスターファイル管理方針

**作成日**: 2025-01-29
**目的**: 全フェーズで共通利用するマスターファイルの管理方針を定義

---

## 背景と目的

### 課題

従来の方式では、用語定義やデータ項目定義が各フェーズに閉じ込められてしまい、以下の問題が発生していました：

1. **用語の重複定義**: 各フェーズで同じ用語を再定義
2. **用語の不整合**: フェーズをまたぐと用語の意味が微妙に変わる
3. **メンテナンスコスト**: 用語更新時に複数箇所を修正
4. **トレーサビリティの欠如**: どの用語がどのフェーズで定義されたか不明確

### 解決策

**`docs/00_master/` 配下に全フェーズ共通のマスターファイルを配置**し、継続的に参照・更新する。

---

## ディレクトリ構造

```
project_MCPphone/
├── 1_guideline/                    # ガイドライン（開発プロセス定義）
│   ├── 1_general/                  # 一般的なフェーズガイド
│   │   ├── 00_標準ガイドライン.md
│   │   ├── 01_システム化計画フェーズ.md
│   │   ├── 02_要件定義フェーズ.md
│   │   ├── 03_基本設計フェーズ.md
│   │   └── ...
│   └── 2_specific/                 # プロジェクト固有のガイド
│
├── 2_docs/                         # ドキュメント（成果物）
│   ├── 00_master/                  # ★全フェーズ共通のマスターファイル
│   │   ├── 01_用語定義マスター.md
│   │   ├── 02_データ項目定義マスター.md
│   │   ├── 03_エンドポイントマスター.md（基本設計以降）
│   │   └── 04_技術仕様マスター.md（基本設計以降）
│   │
│   ├── 01_planning/                # システム化計画フェーズ
│   │   └── システム化計画書.md
│   │
│   ├── 02_requirement/             # 要件定義フェーズ
│   │   ├── 1_definition/           # 要件定義ドキュメント
│   │   │   ├── 00_ユーザーシナリオ.md
│   │   │   ├── 01_要件定義書.md
│   │   │   ├── 02_業務フロー図.md
│   │   │   ├── 03_機能要件定義書.md
│   │   │   ├── 04_非機能要件定義書.md
│   │   │   └── 05_運用要件定義書.md
│   │   ├── 2_sample_data/          # サンプルデータ
│   │   ├── 3_manual/               # ユーザーマニュアル
│   │   └── 4_test/                 # テスト戦略
│   │
│   ├── 03_basic_design/            # 基本設計フェーズ
│   │   ├── _master/                # 基本設計マスターファイル（旧構造、移行推奨）
│   │   ├── 01_処理シーケンス図.md
│   │   └── 02_データモデル.md
│   │
│   ├── 04_detail_design/           # 詳細設計フェーズ
│   ├── 05_implementation/          # 実装フェーズ
│   ├── 06_test/                    # テストフェーズ
│   ├── 07_deploy/                  # デプロイフェーズ
│   └── 08_operation/               # 運用フェーズ
│
└── 3_system/                       # システム本体（ソースコード等）
```

### ディレクトリ構造の特徴

1. **`1_guideline/`**: プロセス定義（HOWを定義）
   - 各フェーズで何を作成すべきかのガイドライン
   - 再利用可能なテンプレート

2. **`2_docs/`**: 成果物（WHATを作成）
   - 実際のプロジェクトドキュメント
   - `00_master/` に全フェーズ共通のマスターファイル

3. **`3_system/`**: システム本体
   - ソースコード、設定ファイル等

---

## マスターファイル一覧

### 1. 用語定義マスター（`2_docs/00_master/01_用語定義マスター.md`）

#### 目的
- プロジェクト全体で使用する用語を一元管理
- フェーズをまたいだ用語の一貫性を確保

#### 作成開始フェーズ
- **要件定義フェーズ**（ユーザーシナリオから用語を抽出）

#### 更新フェーズ
- 全フェーズで継続的に更新

#### ファイル構造

```markdown
# 用語定義マスター

**最終更新日**: 2025-01-29
**管理方針**: 全フェーズで継続的に更新・参照

---

## 用語一覧

| 用語ID | 用語 | 定義 | 別名・略称 | 追加フェーズ | 最終更新 |
|--------|------|------|-----------|------------|----------|
| TERM-001 | 依頼者 | サービスを利用して業務を依頼する一般ユーザー | 利用者、エンドユーザー | 要件定義 | 2025-01-29 |
| TERM-002 | 提携店 | 依頼を受けて実際に業務を遂行する店舗 | 加盟店、パートナー店 | 要件定義 | 2025-01-29 |
| TERM-003 | QRV | Quick Request by Voice（音声による迅速な依頼） | - | 要件定義 | 2025-01-29 |
| TERM-004 | 通常プラン | 音声ガイダンスとLINEを使った標準サービス | ベーシックプラン | 要件定義 | 2025-01-29 |
| TERM-005 | プレミアムプラン | AIチャットボットを使った高度なサービス | - | 要件定義 | 2025-01-29 |
| TERM-006 | タスクキュー | 依頼を順次処理するための待機列 | - | 基本設計 | 2025-01-30 |

---

## 用語カテゴリ

### ビジネス用語
- TERM-001: 依頼者
- TERM-002: 提携店
- TERM-004: 通常プラン
- TERM-005: プレミアムプラン

### 技術用語
- TERM-006: タスクキュー

---

## 用語の追加・更新ルール

### 追加時のルール
1. 新しい用語が出現したら、このマスターに追加
2. 用語IDは連番で付与（TERM-XXX）
3. 「追加フェーズ」欄に最初に定義されたフェーズを記載
4. 各フェーズのドキュメントからこのマスターにリンク

### 更新時のルール
1. 用語の意味が変わる場合は、必ず変更履歴を記録
2. 「最終更新」欄を更新
3. 関連ドキュメントへの影響を確認・通知

### 削除時のルール
1. 用語は原則削除しない（使用しなくなった場合は「廃止」と明記）
2. 代替用語がある場合は「→ TERM-XXX を参照」と記載

---

## 変更履歴

| 日付 | 用語ID | 変更内容 | 理由 | 影響範囲 | 承認者 |
|------|--------|---------|------|---------|--------|
| 2025-01-29 | TERM-001〜005 | 初版作成 | 要件定義開始 | - | 山田太郎 |
| 2025-01-30 | TERM-006 | 新規追加 | 基本設計で必要 | 処理シーケンス図 | 佐藤花子 |
```

---

### 2. データ項目定義マスター（`2_docs/00_master/02_データ項目定義マスター.md`）

#### 目的
- システム全体で使用するデータ項目を一元管理
- 画面・API・データベース間でのデータ項目の整合性を確保

#### 作成開始フェーズ
- **要件定義フェーズ**（画面遷移図からデータ項目を抽出）

#### 詳細化フェーズ
- **基本設計フェーズ**（テーブル設計・API設計で詳細化）

#### ファイル構造

```markdown
# データ項目定義マスター

**最終更新日**: 2025-01-29
**管理方針**: 要件定義で作成開始、基本設計で詳細化

---

## データ項目一覧

| 項目ID | 項目名 | データ型 | 桁数 | 必須 | 制約条件 | 追加フェーズ | 使用箇所 |
|--------|--------|---------|------|------|---------|------------|---------|
| DATA-001 | 依頼者ID | 文字列 | 20 | ○ | UUID形式 | 要件定義 | 依頼管理 |
| DATA-002 | 依頼者名 | 文字列 | 100 | ○ | - | 要件定義 | 依頼管理、通知 |
| DATA-003 | 電話番号 | 文字列 | 11 | ○ | 半角数字のみ | 要件定義 | 依頼管理、認証 |
| DATA-004 | LINE_ID | 文字列 | 50 | △ | LINEユーザーID | 要件定義 | 外部連携 |
| DATA-005 | 依頼ステータス | 列挙型 | - | ○ | [待機中,処理中,完了,キャンセル] | 要件定義 | 依頼管理 |
| DATA-006 | 作成タイムスタンプ | 日時 | - | ○ | ISO 8601形式 | 基本設計 | 全テーブル |
| DATA-007 | 更新タイムスタンプ | 日時 | - | ○ | ISO 8601形式 | 基本設計 | 全テーブル |

---

## データ項目カテゴリ

### ユーザー情報
- DATA-001: 依頼者ID
- DATA-002: 依頼者名
- DATA-003: 電話番号
- DATA-004: LINE_ID

### システム管理情報
- DATA-006: 作成タイムスタンプ
- DATA-007: 更新タイムスタンプ

---

## データ項目の追加・更新ルール

### 追加時のルール
1. 新しいデータ項目が必要になったら、このマスターに追加
2. 項目IDは連番で付与（DATA-XXX）
3. 「追加フェーズ」欄に最初に定義されたフェーズを記載
4. 「使用箇所」欄に使用される画面・API・テーブルを記載

### 更新時のルール
1. データ型・制約条件が変わる場合は、必ず変更履歴を記録
2. 「最終更新」欄を更新
3. 使用箇所への影響を確認（画面・API・DBの全てで整合性確認）

### 削除時のルール
1. データ項目は原則削除しない（使用しなくなった場合は「廃止」と明記）
2. 代替項目がある場合は「→ DATA-XXX を参照」と記載

---

## 変更履歴

| 日付 | 項目ID | 変更内容 | 理由 | 影響範囲 | 承認者 |
|------|--------|---------|------|---------|--------|
| 2025-01-29 | DATA-001〜005 | 初版作成 | 要件定義開始 | - | 山田太郎 |
| 2025-01-30 | DATA-006〜007 | 新規追加 | 監査証跡要件 | 全テーブル | 佐藤花子 |
```

---

### 3. エンドポイントマスター（`2_docs/00_master/03_エンドポイントマスター.md`）

#### 目的
- システム全体のAPIエンドポイントを一元管理
- API間の整合性を確保

#### 作成開始フェーズ
- **基本設計フェーズ**（API設計書から抽出）

#### ファイル構造

```markdown
# エンドポイントマスター

**最終更新日**: 2025-01-30
**管理方針**: 基本設計で作成開始、実装フェーズで更新

---

## エンドポイント一覧

| EP-ID | メソッド | エンドポイント | 概要 | 認証 | 追加フェーズ | 使用箇所 |
|-------|---------|---------------|------|------|------------|---------|
| API-001 | POST | /api/v1/requests | 新規依頼作成 | 必要 | 基本設計 | 依頼者アプリ |
| API-002 | GET | /api/v1/requests/{id} | 依頼詳細取得 | 必要 | 基本設計 | 依頼者アプリ、提携店アプリ |
| API-003 | PUT | /api/v1/requests/{id}/status | 依頼ステータス更新 | 必要 | 基本設計 | 提携店アプリ |

---

## 変更履歴

| 日付 | EP-ID | 変更内容 | 理由 | 影響範囲 | 承認者 |
|------|-------|---------|------|---------|--------|
| 2025-01-30 | API-001〜003 | 初版作成 | 基本設計開始 | - | 佐藤花子 |
```

---

### 4. 技術仕様マスター（`2_docs/00_master/04_技術仕様マスター.md`）

#### 目的
- 採用技術、ライブラリ、バージョン情報を一元管理
- 技術スタックの一貫性を確保

#### 作成開始フェーズ
- **基本設計フェーズ**

#### ファイル構造

```markdown
# 技術仕様マスター

**最終更新日**: 2025-01-30
**管理方針**: 基本設計で作成開始、実装フェーズで更新

---

## 採用技術スタック

### フロントエンド
| 技術 | バージョン | 用途 | 選定理由 | ライセンス |
|------|-----------|------|---------|-----------|
| React | 18.2.0 | UIフレームワーク | 実績豊富、エコシステム充実 | MIT |
| TypeScript | 5.0 | 型安全性 | 開発効率向上、バグ削減 | Apache 2.0 |

### バックエンド
| 技術 | バージョン | 用途 | 選定理由 | ライセンス |
|------|-----------|------|---------|-----------|
| Node.js | 20 LTS | ランタイム | JavaScript統一、非同期処理 | MIT |
| Express | 4.18 | Webフレームワーク | 軽量、柔軟性高い | MIT |

### データベース
| 技術 | バージョン | 用途 | 選定理由 | ライセンス |
|------|-----------|------|---------|-----------|
| PostgreSQL | 15 | メインDB | ACID準拠、拡張性高い | PostgreSQL License |

---

## 変更履歴

| 日付 | 技術 | 変更内容 | 理由 | 影響範囲 | 承認者 |
|------|------|---------|------|---------|--------|
| 2025-01-30 | - | 初版作成 | 基本設計開始 | - | 佐藤花子 |
```

---

## 各フェーズでのマスターファイル管理

### 要件定義フェーズ

#### 編集可能なディレクトリ

```markdown
- ✅ **編集可能**: `2_docs/02_requirement/`
- ✅ **更新可能（追記のみ）**: `2_docs/00_master/01_用語定義マスター.md`
- ✅ **更新可能（追記のみ）**: `2_docs/00_master/02_データ項目定義マスター.md`
- 📖 **参照のみ**: `1_guideline/`, `2_docs/01_planning/`
- ❌ **編集禁止**: その他全て
```

#### マスターファイルの更新ルール

1. **用語定義マスター**
   - ユーザーシナリオで使用した用語を抽出して追加
   - 業務フロー図で新しい用語が出たら追加
   - 要件定義書作成時に用語を統一

2. **データ項目定義マスター**
   - 画面遷移図で使用するデータ項目を追加
   - データ型・制約条件は要件レベルで定義（詳細は基本設計で）

---

### 基本設計フェーズ

#### 編集可能なディレクトリ

```markdown
- ✅ **編集可能**: `2_docs/03_basic_design/`
- ✅ **更新可能（追記・詳細化）**: `2_docs/00_master/02_データ項目定義マスター.md`
- ✅ **作成可能**: `2_docs/00_master/03_エンドポイントマスター.md`
- ✅ **作成可能**: `2_docs/00_master/04_技術仕様マスター.md`
- 📖 **参照のみ**: `1_guideline/`, `2_docs/01_planning/`, `2_docs/02_requirement/`, `2_docs/00_master/01_用語定義マスター.md`
- ❌ **編集禁止**: その他全て
```

#### マスターファイルの更新ルール

1. **用語定義マスター**
   - 技術用語が新たに必要になったら追加
   - 既存用語の定義変更は原則禁止（やむを得ない場合は変更履歴を必ず記録）

2. **データ項目定義マスター**
   - 要件定義で定義した項目を詳細化（データ型の詳細、制約条件の追加）
   - テーブル設計・API設計で新しい項目が必要になったら追加

3. **エンドポイントマスター**（新規作成）
   - API設計書からエンドポイントを抽出
   - 全エンドポイントを一覧化

4. **技術仕様マスター**（新規作成）
   - 採用技術スタックを記載
   - バージョン情報を明記

---

## マスターファイルの変更管理

### 変更時の手順

1. **変更提案**
   - 変更が必要な理由を明確化
   - 影響範囲を特定（どのドキュメント・画面・API・テーブルに影響するか）

2. **影響分析**
   - 関連ドキュメントへの影響を確認
   - 実装済みコードへの影響を確認

3. **レビュー・承認**
   - ステークホルダーによるレビュー
   - プロジェクトリーダーによる承認

4. **変更実施**
   - マスターファイルを更新
   - 変更履歴を記録
   - 関連ドキュメントを更新

5. **通知**
   - 関係者に変更を通知
   - 影響範囲を周知

---

## まとめ

### マスターファイル管理の原則

1. **単一の情報源（Single Source of Truth）**
   - 用語・データ項目は `docs/00_master/` で一元管理
   - 各フェーズのドキュメントはマスターファイルを参照

2. **継続的な更新**
   - フェーズをまたいで継続的に更新
   - 変更履歴を必ず記録

3. **トレーサビリティの確保**
   - どのフェーズで追加されたかを記録
   - 変更理由・影響範囲を明記

4. **削除の禁止**
   - 用語・データ項目は原則削除しない
   - 使用しなくなった場合は「廃止」と明記

5. **整合性の維持**
   - マスターファイル変更時は関連ドキュメントへの影響を確認
   - 全ドキュメントでマスターファイルの用語・データ項目を使用

---

**次のステップ**: 要件定義フェーズを開始する前に、`2_docs/00_master/` ディレクトリを作成してください。

---

## 補足：既存の基本設計マスターファイルについて

現在、`2_docs/03_basic_design/_master/` ディレクトリが存在しますが、この構造は以下の理由で推奨しません：

### 問題点
1. **基本設計フェーズに閉じ込められている**: 他のフェーズから参照しにくい
2. **マスターファイルの分散**: 用語定義やデータ項目定義が複数箇所に散在する可能性

### 推奨される移行方法

既存の `_master/` 配下のファイルを `2_docs/00_master/` に統合することを推奨します：

```bash
# 移行例
2_docs/03_basic_design/_master/用語定義マスター.md
  → 2_docs/00_master/01_用語定義マスター.md

2_docs/03_basic_design/_master/データ項目定義マスター.md
  → 2_docs/00_master/02_データ項目定義マスター.md
```

移行後は、基本設計ドキュメントから `../00_master/` を参照するよう修正してください。
