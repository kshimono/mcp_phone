# 要件定義フェーズガイドライン更新案

**作成日:** 2025-01-29
**目的:** [02_要件定義フェーズ.md](1_guideline/1_general/02_要件定義フェーズ.md) への反映内容を整理

---

## 背景

要件定義フェーズで作成すべきドキュメントと、基本設計フェーズで作成すべきドキュメントの境界を明確にする必要があります。特に以下の図表について、適切な分類が必要です。

### 実施した整理作業

元の `03_図表集.md` を以下のように分割しました：

```
【要件定義に残したもの】
└─ 03_サービスタイプ比較表.md
   - ビジネス要件の整理
   - サービス仕様の比較

【基本設計に移動したもの】
├─ 01_処理シーケンス図.md
│  - システムの処理順序
│  - タイムアウト処理
│  - エラーハンドリング
└─ 02_データモデル.md
   - エンティティ関連図
   - データ構造の詳細
```

---

## 更新提案

### 1. 必須作成物セクションへの追加

現在の `02_要件定義フェーズ.md` の「必須作成物（MUST CREATE）」に以下を追加：

#### 追加項目案

```markdown
### 10. サービス仕様比較表（該当する場合）

複数のサービスタイプやプランを提供するシステムの場合：
- サービスタイプごとの機能比較
- 料金体系の比較
- 確認項目・入力項目の差分整理
- サービス追加時の考慮事項

**注意**: これは**ビジネス要件レベル**での比較です。システム実装の詳細（API仕様、データベース設計）は含めません。
```

---

### 2. 禁止事項セクションの明確化

現在の禁止事項をより詳細にします：

#### 現在の記載

```markdown
## 禁止事項（MUST NOT CREATE）

- ❌ 詳細なデータベース物理設計（基本設計で作成）
- ❌ 詳細なAPI仕様（基本設計で作成）
- ❌ 詳細な画面レイアウト（基本設計で作成）
- ❌ クラス図・シーケンス図（詳細設計で作成）
- ❌ ソースコード（実装フェーズで作成）
- ❌ 詳細なテストケース（テストフェーズで作成）
- ❌ インフラ構築手順（デプロイフェーズで作成）
```

#### 追加提案

```markdown
## 禁止事項（MUST NOT CREATE）

### 基本設計フェーズで作成すべきもの
- ❌ 詳細なデータベース物理設計
- ❌ 詳細なAPI仕様
- ❌ 詳細な画面レイアウト
- ❌ **処理シーケンス図/タイミング図** ←【追加】
- ❌ **ER図（実装レベル）** ←【追加】

### 詳細設計フェーズで作成すべきもの
- ❌ クラス図
- ❌ 詳細なシーケンス図

### その他のフェーズで作成すべきもの
- ❌ ソースコード（実装フェーズで作成）
- ❌ 詳細なテストケース（テストフェーズで作成）
- ❌ インフラ構築手順（デプロイフェーズで作成）
```

---

### 3. 新セクションの追加提案

「要件定義と基本設計の境界」という新セクションを追加します。

#### 追加セクション案

```markdown
---

## 要件定義と基本設計の境界

手戻りを防ぐため、要件定義フェーズと基本設計フェーズの成果物を明確に区別してください。

### 判断基準

| 視点 | 要件定義 | 基本設計 |
|-----|---------|---------|
| **焦点** | WHAT（何を実現するか） | HOW（どのように実現するか） |
| **業務フロー図** | ✅ ビジネスプロセス | ❌ システム処理順序 |
| **データ定義** | ✅ データ項目一覧 | ❌ テーブル設計・ER図 |
| **画面定義** | ✅ 画面遷移図（概念） | ❌ 画面レイアウト（詳細） |
| **通信仕様** | ✅ 外部連携先の特定 | ❌ API詳細仕様 |

### 境界が曖昧になりやすい図表

以下の図表は、**基本設計フェーズで作成**してください：

1. **処理シーケンス図/タイミング図**
   - ❌ 要件定義: システムの処理順序の詳細は含めない
   - ✅ 基本設計: タスクキュー、タイムアウト管理、リトライロジック等を設計

2. **データモデル（ER図）**
   - ❌ 要件定義: テーブル構造の詳細は含めない
   - ✅ 基本設計: エンティティ関連、外部キー、カーディナリティ等を設計

3. **サービス仕様比較表**
   - ✅ 要件定義: ビジネス要件レベルでの比較（料金体系、サービス内容）
   - ❌ 基本設計: システム実装の詳細（API設計、データベース設計）

### 実例: QRVプロジェクトでの分類

| ドキュメント | フェーズ | 理由 |
|------------|---------|------|
| 要件定義書 | 要件定義 | 機能要件・非機能要件の明確化 |
| 業務フロー図 | 要件定義 | ビジネスプロセスの理解 |
| サービスタイプ比較表 | 要件定義 | ビジネス仕様の整理 |
| 処理シーケンス図 | **基本設計** | システムの処理順序、技術的実装 |
| データモデル | **基本設計** | エンティティ関連、データ構造 |

---
```

---

### 4. フェーズゲート2チェックリストへの追加

現在のチェックリストに以下を追加：

```markdown
### 禁止事項確認（境界の明確化）
- [ ] 処理シーケンス図/タイミング図が含まれていないか（基本設計で作成）
- [ ] ER図（実装レベル）が含まれていないか（基本設計で作成）
- [ ] システム処理の詳細な順序が記述されていないか（基本設計で作成）
```

---

## 更新時の注意事項

### 1. 既存チェックリストとの整合性

以下の既存項目との整合性を確認してください：

- 「機能要件が網羅的に記述されているか」
- 「業務フロー図がTO-BEプロセスを反映しているか」

### 2. セキュリティチェックリストへの影響

データモデルを基本設計に移動したことで、以下の項目は基本設計フェーズに移動すべきか検討：

- 「データへのアクセス制御要件があるか」
- 「APIのアクセス制御要件があるか」

ただし、**要件レベル**（「個人情報は暗号化する」）は要件定義に残し、**実装レベル**（「テーブルXXXのカラムYYYをAES-256で暗号化」）は基本設計に移動します。

---

## 更新後のディレクトリ構造例

ガイドラインに以下の構造例を追加することを推奨します：

```markdown
## ディレクトリ構造例

要件定義フェーズと基本設計フェーズのドキュメント配置例：

```
2_docs/
├── 02_requirement/
│   └── 1_definition/
│       ├── 01_要件定義書.md
│       ├── 02_業務フロー図.md
│       ├── 03_サービスタイプ比較表.md ※ビジネス要件の比較
│       └── 2_sample_data/
│           └── 01_サンプルデータ定義
│
└── 03_basic_design/
    ├── 01_処理シーケンス図.md ※システム処理の詳細
    └── 02_データモデル.md      ※ER図、エンティティ設計
```

**ポイント**:
- 要件定義では「何を実現するか」に焦点
- 基本設計では「どのように実現するか」に焦点
```
```

---

## 実施推奨順序

1. **Section 3（境界の明確化）を追加** - 最も重要
2. **Section 2（禁止事項の明確化）を更新**
3. **Section 1（必須作成物）を追加**（該当プロジェクトのみ）
4. **Section 4（チェックリスト）を更新**
5. **ディレクトリ構造例を追加**

---

## まとめ

この更新により、以下が明確になります：

1. **要件定義と基本設計の境界**
2. **処理シーケンス図とデータモデルは基本設計で作成すべき**
3. **サービス仕様比較表は要件定義に含めてもよい**（ビジネス要件レベル）
4. **手戻り防止のための判断基準**

---

**このガイドを参考に、[02_要件定義フェーズ.md](1_guideline/1_general/02_要件定義フェーズ.md) を更新してください。**
