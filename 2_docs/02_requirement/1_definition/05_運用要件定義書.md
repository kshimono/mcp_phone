# QRV 運用要件定義書

**文書バージョン:** 1.0
**作成日:** 2025-01-29
**最終更新日:** 2025-01-29
**プロジェクトコード:** QRV
**プロジェクト名（英語）:** Qualfia Reservation
**プロジェクト名（日本語）:** 未定

**関連文書:**
- [要件定義書](01_要件定義書.md)
- [機能要件定義書](03_機能要件定義書.md)
- [非機能要件定義書](04_非機能要件定義書.md)
- [業務フロー図](02_業務フロー図.md)

---

## 目次

1. [概要](#1-概要)
2. [システム境界とマニュアルオペレーション](#2-システム境界とマニュアルオペレーション)
3. [ユーザー教育要件](#3-ユーザー教育要件)
4. [運用監視要件](#4-運用監視要件)
5. [インシデント対応手順](#5-インシデント対応手順)
6. [定期メンテナンス](#6-定期メンテナンス)
7. [サポート体制](#7-サポート体制)

---

## 1. 概要

### 1.1 文書の目的

本文書は、QRV（Qualfia Reservation）システムの運用要件を定義します。システムが自動処理できない範囲を明確にし、マニュアルオペレーションが必要な場面、ユーザー教育の内容、運用監視の方法、インシデント対応手順を規定します。

### 1.2 対象読者

- Qualfia運営担当者
- カスタマーサポート担当者
- システム運用担当者
- 提携店担当者

### 1.3 運用要件の重要性

運用要件を事前に定義することで、以下のメリットがあります：

- **手戻り防止**: システム開発後に「運用できない」という問題の回避
- **運用コスト見積もり**: 必要な人員・時間の事前把握
- **ユーザー満足度向上**: 適切な教育とサポート体制の構築
- **障害対応の迅速化**: 手順の事前整備

---

## 2. システム境界とマニュアルオペレーション

### 2.1 システムが自動処理する範囲

以下の処理はシステムが自動で実行します：

| 処理 | 自動化範囲 |
|------|----------|
| **予約受付** | MCPクライアント経由の予約リクエスト受付 |
| **SMS送信** | 依頼者への確認SMS、決済リンクSMS、リマインダーSMS |
| **電話代行** | 提携店への自動音声電話（最大2周） |
| **決済処理** | Stripe経由のオンライン決済 |
| **通知送信** | Email通知（依頼者・提携店） |
| **リトライ処理** | SMS送信失敗、電話発信失敗時の自動リトライ |

---

### 2.2 マニュアルオペレーションが必要な範囲

以下の場面ではマニュアルオペレーション（人手による対応）が必要です：

#### 2.2.1 全店舗予約NGの場合

**発生条件:**
- 提携店リスト全店舗（2周）で予約が取れなかった場合

**システムの自動処理:**
1. 依頼者にSMS送信: 「現在、予約できませんでした。別の日時をご検討いただくか、カスタマーサポートまでご連絡ください」
2. 管理者にSlack通知: 「予約ID: QRV-XXXXXX が全店NG」

**マニュアルオペレーション:**
1. 運営担当者が予約内容を確認
2. 以下のいずれかを実施:
   - **対応可能な提携店を手動で探す**: CSVに未登録の店舗に電話確認
   - **日時変更を提案**: 依頼者に電話連絡し、別の日時を提案
   - **キャンセル処理**: 依頼者の希望により予約をキャンセル（決済なし）

**所要時間見積もり:**
- 1件あたり15〜30分

**発生頻度見積もり:**
- 全予約の5%程度（月間50件で2〜3件）

---

#### 2.2.2 SMS送信が全リトライ失敗

**発生条件:**
- 依頼者の電話番号が無効、またはSMS受信拒否設定

**システムの自動処理:**
1. 管理者にSlack通知: 「予約ID: QRV-XXXXXX のSMS送信が全て失敗」

**マニュアルオペレーション:**
1. 運営担当者が予約内容を確認
2. 依頼者の電話番号に電話連絡
3. 電話で予約内容を確認し、Email送信で代替
4. 決済リンクをEmailで送信

**所要時間見積もり:**
- 1件あたり10〜15分

**発生頻度見積もり:**
- 全予約の1%程度（月間50件で0〜1件）

---

#### 2.2.3 決済リンク期限切れ

**発生条件:**
- 依頼者が決済リンク送信後10分以内に決済を完了しなかった場合

**システムの自動処理:**
1. 予約ステータスを `payment_timeout` に更新
2. 依頼者にSMS送信: 「決済期限が切れました。再度予約をお願いします」
3. 提携店の仮予約をキャンセル（Email通知）

**マニュアルオペレーション:**
- 基本的に不要（依頼者が再予約する前提）
- 依頼者から問い合わせがあった場合のみ対応:
  - 事情を確認し、再度予約を案内

**所要時間見積もり:**
- 1件あたり5〜10分（問い合わせがあった場合のみ）

**発生頻度見積もり:**
- 全予約の10%程度（月間50件で5件）

---

#### 2.2.4 提携店からの曖昧な回答

**発生条件:**
- 電話代行時に提携店が「検討します」「後で連絡します」など曖昧な回答

**システムの自動処理:**
1. AIが「では、お電話を切らせていただきます。ご連絡お待ちしております」と応答
2. 予約ステータスを `pending_shop_response` に更新
3. 管理者にSlack通知: 「予約ID: QRV-XXXXXX が曖昧な回答」

**マニュアルオペレーション:**
1. 運営担当者が該当提携店に電話確認（1時間以内）
2. 確定回答を取得:
   - **予約OK**: 手動で予約ステータスを `calling_success` に更新 → 決済リンク送信
   - **予約NG**: 次の提携店に電話代行を再開

**所要時間見積もり:**
- 1件あたり10〜15分

**発生頻度見積もり:**
- 全予約の3%程度（月間50件で1〜2件）

---

#### 2.2.5 提携店からの予約内容変更依頼

**発生条件:**
- 提携店が「希望時間を30分ずらしてほしい」「サイズを変更してほしい」など変更を要望

**システムの自動処理:**
1. AIが「承知しました。確認して折り返しご連絡いたします」と応答
2. 管理者にSlack通知: 「予約ID: QRV-XXXXXX で変更依頼」

**マニュアルオペレーション:**
1. 運営担当者が依頼者に電話連絡
2. 変更内容を説明し、承諾を得る:
   - **承諾**: 手動で予約内容を更新 → 決済リンク送信
   - **拒否**: 提携店に断りの連絡 → 次の提携店に電話代行を再開

**所要時間見積もり:**
- 1件あたり15〜20分

**発生頻度見積もり:**
- 全予約の5%程度（月間50件で2〜3件）

---

#### 2.2.6 キャンセル期限超過後のキャンセル依頼

**発生条件:**
- 依頼者が予約日時の48時間前を過ぎてからキャンセルを依頼

**システムの自動処理:**
- キャンセルURL経由: 「キャンセル期限を過ぎています。カスタマーサポートまでご連絡ください」と表示

**マニュアルオペレーション:**
1. 運営担当者が依頼者の事情を確認
2. 特別な事情（病気、事故等）がある場合:
   - 提携店に連絡してキャンセル交渉
   - 提携店が承諾した場合: 手動でキャンセル処理 → 返金処理
   - 提携店が拒否した場合: 依頼者に説明 → 返金なし
3. 特別な事情がない場合:
   - キャンセルポリシーを説明 → 返金なし

**所要時間見積もり:**
- 1件あたり20〜30分

**発生頻度見積もり:**
- 全予約の2%程度（月間50件で1件）

---

### 2.3 マニュアルオペレーションの体制

#### 2.3.1 運営体制

| 役割 | 担当者数 | 稼働時間 |
|------|---------|---------|
| **運営担当者** | 2名 | 平日9:00〜18:00 |
| **カスタマーサポート** | 1名 | 平日9:00〜18:00 |
| **オンコール対応** | 1名（輪番） | 土日祝、夜間 |

#### 2.3.2 対応優先度

| 優先度 | 対応内容 | 対応時間目標 |
|-------|---------|-------------|
| **緊急** | SMS送信失敗、決済システム障害 | 30分以内 |
| **高** | 全店予約NG、曖昧な回答 | 1時間以内 |
| **中** | 予約内容変更依頼、キャンセル期限超過 | 2時間以内 |
| **低** | 一般問い合わせ | 24時間以内 |

---

## 3. ユーザー教育要件

### 3.1 依頼者向け教育

#### 3.1.1 前提知識

依頼者が予約システムを利用するために必要な前提知識：

| 項目 | 前提知識レベル | 説明 |
|------|--------------|------|
| **AIチャット操作** | 基本レベル | Claude Desktop、ChatGPT等のチャットインターフェースの基本操作 |
| **SMS受信** | 基本レベル | スマートフォンでSMSを受信・確認できる |
| **オンライン決済** | 基本レベル | クレジットカード決済の経験がある |
| **MCP設定** | 不要 | MCPクライアントの設定は別途ガイドで提供 |

#### 3.1.2 教育コンテンツ

依頼者向けに以下のコンテンツを提供：

| コンテンツ名 | 形式 | 内容 | 所要時間 |
|------------|------|------|---------|
| **クイックスタートガイド** | PDF | 予約の流れ、SMS確認、決済手順 | 5分 |
| **FAQ** | Webページ | よくある質問と回答 | 必要時参照 |
| **サンプル対話例** | PDF | AIとの対話例（サービスごと） | 3分 |
| **キャンセル手順** | PDF | キャンセルURL経由の手順 | 2分 |

#### 3.1.3 教育方法

- **初回利用時**: AIが対話内で簡単な説明を提供
- **Webサイト**: 上記コンテンツをダウンロード可能
- **カスタマーサポート**: 電話・Emailで問い合わせ対応

---

### 3.2 提携店向け教育

#### 3.2.1 前提知識

提携店がシステムを利用するために必要な前提知識：

| 項目 | 前提知識レベル | 説明 |
|------|--------------|------|
| **電話対応** | 基本レベル | 自動音声電話に応答できる |
| **Email受信** | 基本レベル | Email通知を受信・確認できる |
| **予約管理** | 不要 | システムが予約情報をEmailで送信 |

#### 3.2.2 教育コンテンツ

提携店向けに以下のコンテンツを提供：

| コンテンツ名 | 形式 | 内容 | 所要時間 |
|------------|------|------|---------|
| **提携店向けマニュアル** | PDF | 電話受付の流れ、回答方法、Email通知 | 10分 |
| **電話スクリプト例** | PDF | 自動音声の内容と回答例 | 5分 |
| **FAQ** | PDF | よくある質問と回答 | 必要時参照 |
| **トラブルシューティング** | PDF | 電話が聞き取れない等の対処法 | 5分 |

#### 3.2.3 教育方法

- **契約時**: 提携店向けマニュアルを送付
- **導入説明会**: オンライン説明会（30分）を月1回開催
- **Qualfia担当者**: 電話・Emailで問い合わせ対応

---

### 3.3 運営担当者向け教育

#### 3.3.1 前提知識

運営担当者がシステムを運用するために必要な前提知識：

| 項目 | 前提知識レベル | 説明 |
|------|--------------|------|
| **システム基礎知識** | 中級レベル | API、データベース、タスクキューの概念理解 |
| **ログ確認** | 中級レベル | CloudWatch Logsでログを検索・確認できる |
| **トラブルシューティング** | 中級レベル | エラーメッセージから原因を特定できる |

#### 3.3.2 教育コンテンツ

運営担当者向けに以下のコンテンツを提供：

| コンテンツ名 | 形式 | 内容 | 所要時間 |
|------------|------|------|---------|
| **運用マニュアル** | PDF | システム概要、マニュアルオペレーション手順 | 30分 |
| **インシデント対応手順書** | PDF | 障害発生時の対応フロー | 20分 |
| **ログ確認ガイド** | PDF | CloudWatch Logsの使い方、検索方法 | 15分 |
| **Slack通知一覧** | PDF | 通知内容と対応方法 | 10分 |

#### 3.3.3 教育方法

- **入社時**: 運用マニュアルを読み込み + OJT（1週間）
- **定期勉強会**: 月1回、新機能や改善点を共有
- **ドキュメント更新**: システム変更時に随時更新

---

## 4. 運用監視要件

### 4.1 監視項目

#### 4.1.1 システム監視

| 監視項目 | 監視方法 | 確認頻度 | 対応優先度 |
|---------|---------|---------|-----------|
| **サーバー死活** | Pingdom | 5分間隔（自動） | 緊急 |
| **CPU使用率** | CloudWatch | 5分間隔（自動） | 高 |
| **メモリ使用率** | CloudWatch | 5分間隔（自動） | 高 |
| **Celeryキュー長** | CloudWatch | 1分間隔（自動） | 高 |
| **エラー率** | CloudWatch | 5分間隔（自動） | 緊急 |

#### 4.1.2 ビジネス監視

| 監視項目 | 監視方法 | 確認頻度 | 対応優先度 |
|---------|---------|---------|-----------|
| **予約成功率** | ダッシュボード | 日次（手動） | 中 |
| **決済成功率** | ダッシュボード | 日次（手動） | 中 |
| **マニュアルオペレーション件数** | Slack通知カウント | 日次（手動） | 低 |
| **キャンセル率** | ダッシュボード | 週次（手動） | 低 |

---

### 4.2 ダッシュボード

#### 4.2.1 運営担当者向けダッシュボード

**表示項目:**
- 今日の予約件数（ステータス別）
- 今日のマニュアルオペレーション件数
- 今週の予約成功率グラフ
- 今週の決済成功率グラフ
- 直近のSlack通知一覧

**更新頻度:**
- 5分間隔（自動）

**アクセス方法:**
- Webブラウザ経由（社内IPのみ）

---

#### 4.2.2 経営陣向けダッシュボード

**表示項目:**
- 月間予約件数推移
- 月間売上推移
- サービスタイプ別予約割合
- 提携店別予約件数ランキング

**更新頻度:**
- 日次（深夜バッチ）

**アクセス方法:**
- Webブラウザ経由、またはPDFレポート送信

---

### 4.3 アラート設定

#### 4.3.1 Slack通知

全てのアラートはSlackチャンネル `#qrv-alerts` に通知：

| アラートタイプ | 通知条件 | 通知内容 |
|-------------|---------|---------|
| **システムダウン** | Pingdom死活監視失敗 | 「システムがダウンしています」 |
| **CPU高負荷** | CPU 80%超過（5分継続） | 「CPU使用率が高い状態です」 |
| **キュー長超過** | Celeryキュー長100件超過 | 「予約キューが溜まっています」 |
| **エラー率高** | エラー率5%超過 | 「エラーが多発しています」 |
| **マニュアルオペ** | 各種マニュアルオペレーション発生 | 「予約ID: XXX で手動対応が必要」 |

---

## 5. インシデント対応手順

### 5.1 インシデントレベル定義

| レベル | 定義 | 対応時間目標 | エスカレーション |
|-------|------|-------------|----------------|
| **Critical** | システム全体停止、決済システム障害 | 30分以内 | 即座に経営陣に報告 |
| **High** | 一部機能停止、外部API障害 | 1時間以内 | 2時間以内に経営陣に報告 |
| **Medium** | パフォーマンス劣化、マニュアルオペ多発 | 2時間以内 | 24時間以内に報告 |
| **Low** | 軽微な不具合、一時的なエラー | 24時間以内 | 週次報告で共有 |

---

### 5.2 インシデント対応フロー

#### 5.2.1 Criticalレベル

**発生例:**
- システム全体がダウン
- 決済システムが全く動作しない

**対応手順:**
1. **検知（0分）**: Pingdomアラート → Slack通知
2. **初動対応（5分以内）**:
   - オンコール担当者がログ確認
   - 原因の初期判断（サーバー停止、データベース障害、外部API障害等）
3. **応急処置（30分以内）**:
   - サーバー再起動
   - 前バージョンへロールバック
   - 一時的な回避策の実施
4. **復旧確認（45分以内）**:
   - ヘルスチェック確認
   - smoke test実施
5. **事後対応**:
   - 経営陣に報告
   - ポストモーテム作成（24時間以内）
   - 再発防止策の検討・実施

---

#### 5.2.2 Highレベル

**発生例:**
- Bland.ai障害で電話発信が全く動作しない
- Twilio障害でSMS送信が全く動作しない

**対応手順:**
1. **検知（0分）**: CloudWatch Alarmまたはマニュアルオペ多発で気づく
2. **初動対応（15分以内）**:
   - 運営担当者がログ確認
   - 外部APIのステータスページ確認
3. **応急処置（1時間以内）**:
   - 外部API障害の場合: 復旧を待つ + 依頼者に状況説明SMS送信
   - QRV側の問題の場合: コード修正 + デプロイ
4. **復旧確認（1.5時間以内）**:
   - 機能テスト実施
5. **事後対応**:
   - 経営陣に報告（2時間以内）
   - インシデントレポート作成（48時間以内）

---

#### 5.2.3 Mediumレベル

**発生例:**
- API応答時間が遅い（5秒超過）
- マニュアルオペレーションが通常の2倍発生

**対応手順:**
1. **検知（0分）**: CloudWatch Alarmまたは日次確認で気づく
2. **初動対応（30分以内）**:
   - 運営担当者が原因調査
   - メトリクス確認（CPU、メモリ、キュー長等）
3. **対応（2時間以内）**:
   - パフォーマンス改善（Celeryワーカー追加、データベースチューニング等）
   - マニュアルオペ多発の場合: 提携店リストを見直し
4. **事後対応**:
   - 週次報告で共有

---

#### 5.2.4 Lowレベル

**発生例:**
- 一時的なSMS送信失敗（リトライで成功）
- 特定店舗への電話が繋がらない

**対応手順:**
1. **検知（0分）**: ログ確認で気づく
2. **対応（24時間以内）**:
   - 必要に応じて修正
   - 重大な問題でない場合は様子見
3. **事後対応**:
   - 週次報告で共有

---

### 5.3 インシデント記録

#### 5.3.1 記録項目

全てのインシデント（Medium以上）は以下の項目を記録：

| 項目 | 説明 |
|------|------|
| **発生日時** | インシデント検知時刻 |
| **レベル** | Critical / High / Medium / Low |
| **影響範囲** | 影響を受けた機能、ユーザー数 |
| **原因** | 根本原因の特定 |
| **対応内容** | 実施した対応の詳細 |
| **復旧日時** | サービス復旧時刻 |
| **再発防止策** | 今後の対策 |

#### 5.3.2 記録方法

- **ツール**: Notion / Google Sheets
- **アクセス権限**: 運営担当者、経営陣

---

## 6. 定期メンテナンス

### 6.1 日次メンテナンス

| 作業内容 | 実施時間 | 所要時間 | 担当者 |
|---------|---------|---------|--------|
| **ダッシュボード確認** | 10:00 | 5分 | 運営担当者 |
| **Slack通知確認** | 10:00 | 5分 | 運営担当者 |
| **マニュアルオペ対応** | 随時 | 変動 | 運営担当者 |

---

### 6.2 週次メンテナンス

| 作業内容 | 実施曜日 | 所要時間 | 担当者 |
|---------|---------|---------|--------|
| **週次レポート作成** | 金曜日 | 30分 | 運営担当者 |
| **ログ確認** | 月曜日 | 30分 | 運営担当者 |
| **提携店リスト更新** | 随時 | 変動 | 運営担当者 |

---

### 6.3 月次メンテナンス

| 作業内容 | 実施日 | 所要時間 | 担当者 |
|---------|-------|---------|--------|
| **月次レポート作成** | 月初5営業日以内 | 1時間 | 運営担当者 |
| **データベースバックアップ確認** | 月初 | 15分 | システム管理者 |
| **脆弱性スキャン** | 月初 | 30分 | システム管理者 |
| **提携店向け説明会** | 月中 | 30分 | Qualfia担当者 |

---

### 6.4 四半期メンテナンス

| 作業内容 | 実施月 | 所要時間 | 担当者 |
|---------|-------|---------|--------|
| **システムレビュー** | 4/7/10/1月 | 2時間 | 開発チーム + 運営担当者 |
| **ユーザー満足度調査** | 4/7/10/1月 | 1週間 | カスタマーサポート |
| **コスト見直し** | 4/7/10/1月 | 1時間 | 経営陣 |

---

## 7. サポート体制

### 7.1 依頼者向けサポート

#### 7.1.1 サポートチャネル

| チャネル | 対応時間 | 対応内容 | 初回応答時間目標 |
|---------|---------|---------|----------------|
| **Email** | 平日9:00〜18:00 | 予約に関する問い合わせ、トラブル対応 | 2時間以内 |
| **電話** | 平日9:00〜18:00 | 緊急のトラブル対応 | 即時 |
| **FAQ** | 24時間 | よくある質問の自己解決 | - |

#### 7.1.2 サポート対応フロー

1. **問い合わせ受付**: Email / 電話
2. **内容確認**: 予約ID、状況のヒアリング
3. **対応**:
   - **FAQ記載内容**: その場で回答
   - **システム確認が必要**: ログ確認後に折り返し連絡
   - **マニュアルオペレーション**: 上記「2.2 マニュアルオペレーション」の手順に従う
4. **記録**: 問い合わせ内容と対応をNotion / Google Sheetsに記録

---

### 7.2 提携店向けサポート

#### 7.2.1 サポートチャネル

| チャネル | 対応時間 | 対応内容 | 初回応答時間目標 |
|---------|---------|---------|----------------|
| **Email** | 平日9:00〜18:00 | システムに関する問い合わせ | 4時間以内 |
| **電話** | 平日9:00〜18:00 | 予約内容の確認、トラブル対応 | 即時 |
| **FAQ** | 24時間 | よくある質問の自己解決 | - |

#### 7.2.2 サポート対応フロー

1. **問い合わせ受付**: Email / 電話
2. **内容確認**: 提携店ID、予約ID、状況のヒアリング
3. **対応**:
   - **FAQ記載内容**: その場で回答
   - **予約内容確認**: システムで確認して回答
   - **予約変更依頼**: 依頼者に連絡して確認
4. **記録**: 問い合わせ内容と対応をNotion / Google Sheetsに記録

---

### 7.3 サポート品質管理

#### 7.3.1 KPI

| KPI | 目標値 | 測定頻度 |
|-----|-------|---------|
| **初回応答時間** | 2時間以内（Email）、即時（電話） | 週次 |
| **解決時間** | 24時間以内（Medium以下） | 週次 |
| **顧客満足度** | 4.0以上（5段階評価） | 四半期 |

#### 7.3.2 改善サイクル

- **週次**: サポート対応内容をレビュー、FAQに追加すべき内容を検討
- **月次**: よくある問い合わせをまとめて、システム改善提案
- **四半期**: 顧客満足度調査の結果を分析、サポート体制の見直し

---

**文書終了**
