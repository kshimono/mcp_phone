# QRV 機能要件定義書

**文書バージョン:** 1.0
**作成日:** 2025-01-29
**最終更新日:** 2025-01-29

**関連文書:**
- [要件定義書](01_要件定義書.md)
- [業務フロー図](02_業務フロー図.md)
- [非機能要件定義書](04_非機能要件定義書.md)
- [運用要件定義書](05_運用要件定義書.md)
- [サンプルデータ定義](2_sample_data/)

---

## 目次

1. [予約受付機能](#1-予約受付機能)
2. [電話代行機能](#2-電話代行機能)
3. [決済機能](#3-決済機能)
4. [通知機能](#4-通知機能)
5. [管理機能](#5-管理機能)
6. [キャンセル機能](#6-キャンセル機能)
7. [データ暗号化機能](#7-データ暗号化機能)
8. [サービスタイプ管理機能](#8-サービスタイプ管理機能)

---

## 1. 予約受付機能

### 1.1 チャット予約受付

**機能概要:**
- MCPクライアント（Claude Desktop、ChatGPT等）から予約依頼を受付
- AIエージェントがサービスタイプに応じた必要情報を対話的に収集

**入力情報:**
- サービスタイプコード（例: 00001, 00002）
- サービス固有の詳細情報（サービスタイプごとに異なる）
- 連絡先電話番号（全サービス共通）

**処理:**
1. サービスタイプに応じた要件定義を読み込み
2. 必須項目が揃っているかチェック
3. 不足情報をAIが対話で確認
4. 全情報が揃ったら予約内容を依頼者に確認
5. 依頼者が承認したら予約リクエスト作成

**出力:**
- 予約ID（例: QRV-A3F9D2）
- 「SMSで確認リンクを送信します」メッセージ

**エラーケース:**
- サービスタイプが不明: サービス一覧を提示
- 必須情報不足: 不足項目を再度質問
- 電話番号形式エラー: 正しい形式での再入力を依頼

**AIエージェントの対話方針:**

AIエージェントは、**固定的な対話テンプレートに依存せず**、以下の方針で柔軟に対話を進めます。

**基本方針:**
1. **必須項目の完全収集**: サービスタイプごとの必須項目を全て収集するまで対話を継続
2. **柔軟な質問順序**: 依頼者が提供した情報に応じて、質問の順序を動的に調整
3. **曖昧さの解消**: 不明確な情報は具体的に確認し、誤解を防ぐ
4. **修正要求への対応**: 依頼者からの修正要求に柔軟に対応
5. **最終確認の実施**: 全情報収集後、予約内容を整理して最終確認を取る

**対話の進め方:**
- 依頼者が部分的な情報を提供した場合: 不足項目のみを追加で質問
- 依頼者が全情報を提供した場合: 即座に最終確認へ進む
- 依頼者が曖昧な表現を使用した場合: 具体的な確認で明確化
- 依頼者が修正を要求した場合: 該当項目のみ再確認

**重要:** 会話テンプレートは定義せず、AIエージェントが状況に応じて自然な対話を行います。具体的な対話例は、[サンプルデータ](2_sample_data/)を参照してください。

---

### 1.2 予約状況問い合わせ

**機能概要:**
- MCP経由で予約IDを指定して状況を確認
- セッションが切断された場合でも予約状況を確認可能

**入力情報:**
- 予約ID（例: QRV-A3F9D2）

**処理:**
1. 予約IDでDB検索
2. 現在のステータスを返却
3. 決済待ちの場合は決済リンクを再送信可能に

**出力:**
- 予約ステータス
- 予約内容の詳細
- 次に取るべきアクション（決済待ち、電話代行中等）

**対話パターン:**
```
[依頼者] 予約ID QRV-XXXXXXの状況を教えて

[AI] 予約ID: QRV-XXXXXXの状況を確認しました。

     【現在の状況】
     ステータス: [ステータス名]
     サービス: {サービス名}
     日時: {予約日時}
     住所: {住所}
     料金: {料金}円

     [次のアクション案内]

     [必要に応じて] 決済リンクを再送しますか？
```

**エラーケース:**
- 予約IDが存在しない: 「予約が見つかりません」
- 予約が既にキャンセル済み: 「この予約はキャンセルされています」

---

### 1.3 SMS確認機能

**機能概要:**
- 依頼者の電話番号にSMS送信
- 10分以内に「進める」ボタンを押すと電話代行開始
- タイムアウト時間は設定パラメータとして管理可能

**処理:**
1. 予約リクエスト作成後、即座にSMS送信（最大3回リトライ）
2. SMS内容: 予約内容 + 「進める」「キャンセル」ボタン付きリンク
3. 依頼者が「進める」押下 → 電話代行タスク開始
4. 依頼者が「キャンセル」押下 → 予約リクエスト削除、通知なし
5. 10分経過で未押下 → 予約リクエスト削除、最初からやり直し

**SMS送信失敗時:**
- 最大3回リトライ
- 全て失敗 → AIチャットで「SMSが送信されるまで本セッションは切らないでください」と表示
- 電話番号確認を促す

---

## 2. 電話代行機能

### 2.1 提携店選定

**機能概要:**
- サービスタイプに応じた提携店CSVを読み込み
- 対応エリアでフィルタリング
- 電話受付時間内の店舗のみを抽出
- スコア降順でソート

**処理:**
1. `data/shops_{service_type}.csv` を読み込み
2. `supported_areas` に依頼者の住所（区）が含まれる店舗を抽出
3. 現在時刻が `phone_reception_start` 〜 `phone_reception_end` の範囲内の店舗のみを抽出
4. `score`（降順）でソート
5. ソート済みリストを返す

**電話受付時間外の場合:**
- 受付時間内の店舗がない場合は、全店NGとして扱う
- 依頼者にSMSで「現在、受付時間外のため予約できませんでした」と通知
- 予約ステータスを `failed` に更新して処理終了

---

### 2.2 自動音声電話

**機能概要:**
- 提携店に直列で自動音声電話
- 仮予約成功したら終了、全店NGなら2周まで試行

**電話スクリプト構成:**

**1. Opening（全サービス共通）**
```
[AI] こんにちは、Qualfia 電話予約代行です。今お電話可能でしょうか？
[店] はい
[AI] ご担当者はいらっしゃいますか？
[店] ＜担当者に取り次ぎ＞
[AI] ありがとうございます。サービスタイプ番号 {service_type} {service_name}です。
```

**2. Requirements（伝えるべき内容、サービス固有）**
- サービス要件定義から `requirements_to_communicate` を読み込み
- テンプレートに変数を埋め込んで伝達
- サービスタイプごとに異なる内容を伝達（詳細はサンプルデータ参照）

**3. Confirmation（確認メッセージ、サービス固有）**
- サービス要件定義から `confirmation_messages` を読み込み
- テンプレートに変数を埋め込んで確認
- 仮予約の説明を含める：
  ```
  【重要】お客様が10分以内に決済されない場合は、自動的にキャンセルとなります。
  決済完了まで、この時間枠は仮押さえとして扱っていただき、
  他のご予約も並行して受け付けていただいて構いません。
  決済完了後、改めて確定通知をお送りいたします。
  ```

**店側の応答パターン:**

| 応答 | 処理 |
|------|------|
| 予約成功 | 通話ログ記録、次の処理へ |
| 時間帯が埋まっている | 代替案があれば記録、次の店へ |
| エリア対応不可 | 通話ログ記録、次の店へ |
| 電話に出ない（30秒） | 通話ログ記録、次の店へ |
| 追加情報要求（性別等） | 「詳細はお客様と直接」と回答、対応不可なら次の店へ |
| 時間外提案（希望外） | 代替案として記録、次の店へ |

**リトライロジック:**
- 1周目: 全提携店に順次電話
- 全店NG → 2周目開始（応答なし・話中の店舗のみ）
- 2周目: 1周目で「応答なし」「話中」だった店舗のみ再トライ
- 2周目も全店NG → 全店NG処理へ

**2周目の対象:**

| 1周目の結果 | 2周目で再トライ |
|------------|----------------|
| 応答なし（30秒タイムアウト） | ✓ する |
| 話中 | ✓ する |
| 時間帯が埋まっている | ✗ しない |
| エリア対応不可 | ✗ しない |
| 追加情報要求で対応不可 | ✗ しない |
| その他の理由で不可 | ✗ しない |

**通話ログ記録:**
- 予約ID、店舗ID、試行回数（1周目/2周目）
- 通話結果（成功/不可/応答なし/エリア外等）
- 代替案（時間外提案等）
- 通話時間

---

### 2.3 全店NG時の処理

**機能概要:**
- 2周しても全店NGの場合、依頼者に代替案を提示

**処理:**
1. 通話ログから代替案を抽出
2. 代替可能な時間帯をまとめる
3. 依頼者にSMS送信

**SMS内容:**
```
【Qualfia予約代行】

申し訳ございません。
ご希望の条件で予約できませんでした。

■ ご依頼内容
日時: {希望日時}（例: 1月28日 14:00-17:00の間）
サービス: {サービス名} {詳細}（例: アロママッサージ 60分）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）

■ 代替可能な時間帯
以下の時間帯でしたら予約可能な見込みです：
- {代替案}（例: 1月28日 18:00以降）

■ 再予約する場合
以下のテキストをコピーしてAIエージェントに貼り付けてください：

---
{再予約用プロンプト}
---
```

---

## 3. 決済機能

### 3.1 決済リンク送信

**機能概要:**
- 仮予約成功後、依頼者にSMSで決済リンク送信
- 10分以内に決済完了で予約確定

**処理:**
1. 料金計算（サービスタイプごとの料金計算ロジックを実装）
2. Stripe Checkout Session作成
3. 依頼者にSMS送信（最大3回リトライ）
4. 提携店にもSMS/Email送信

**依頼者へのSMS:**
```
【Qualfia予約代行】予約が完了しました。

■ 予約内容
予約ID: {予約ID}（例: QRV-A3F9D2）
サービス: {サービス名}（例: アロママッサージ）
日時: {予約日時}（例: 1月28日(火) 15:00-16:00）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）
料金: {料金}円（例: 2,200円）

【重要】10分以内に決済しないと自動キャンセルされます

以下のリンクから決済してください：
https://qualfia.com/phone/book/{予約ID}
```

**提携店へのSMS:**
```
【Qualfia予約代行】予約が確定しました。

予約ID: {予約ID}（例: QRV-A3F9D2）
日時: {予約日時}（例: 1月28日(火) 15:00-16:00）
サービス: {サービス詳細}（例: アロママッサージ 60分）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）
お客様電話: {電話番号}
料金: {料金}円（決済待ち）

10分以内にお客様が決済されない場合は、キャンセルとなります。
決済完了後、再度ご連絡いたします。
```

**SMS送信失敗時:**
- 最大3回リトライ
- 全て失敗 → 予約を自動キャンセル、提携店にも通知

---

### 3.2 決済処理

**機能概要:**
- Stripe Checkoutで決済処理
- 10分のタイムアウト監視

**処理:**
1. 依頼者が決済リンクをクリック
2. Stripe Checkoutページ表示
3. 決済完了 → Webhookで通知受信
4. 予約ステータスを「paid」に更新
5. 依頼者・提携店に確定SMS送信

**依頼者への決済完了SMS:**
```
【Qualfia予約代行】決済が完了しました。予約が確定しました。

■ 予約内容
予約ID: {予約ID}（例: QRV-A3F9D2）
サービス: {サービス名}（例: アロママッサージ）
日時: {予約日時}（例: 1月28日(火) 15:00-16:00）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）
料金: {料金}円（決済済み）

当日は担当者が直接お伺いします。
2日前と2時間前にリマインダーSMSをお送りします。

キャンセルは48時間前まで可能です：
https://qualfia.com/phone/cancel/{予約ID}
```

**提携店への決済完了SMS:**
```
【Qualfia予約代行】お客様の決済が完了しました。予約が確定しました。

予約ID: {予約ID}（例: QRV-A3F9D2）
日時: {予約日時}（例: 1月28日(火) 15:00-16:00）
サービス: {サービス詳細}（例: アロママッサージ 60分）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）
お客様電話: {電話番号}
料金: {料金}円（決済済み）

2日前と2時間前にリマインダーSMSをお送りします。
```

**10分タイムアウト時:**
1. 決済未完了を検知
2. 予約を自動解放
3. 依頼者・提携店にリリース通知SMS送信

**依頼者へのリリース通知:**
```
【Qualfia予約代行】

予約ID: {予約ID}

10分以内に決済が完了しなかったため、予約を解放しました。
再度予約をご希望の場合は、AIエージェント経由でお願いします。
```

**提携店へのリリース通知:**
```
【Qualfia予約代行】

予約ID: {予約ID}

お客様の決済が完了しなかったため、予約をキャンセルいたしました。
```

---

## 4. 通知機能

### 4.1 リマインダー送信

**機能概要:**
- 予約日の48時間前と2時間前にSMS送信（2回）
- リマインダー送信時間は設定パラメータとして管理可能

**第1回リマインダー（48時間前）:**

**依頼者へのリマインダー:**
```
【Qualfia予約代行】予約のリマインダーです。

予約ID: {予約ID}（例: QRV-A3F9D2）
日時: {予約日時}（2日後）（例: 1月28日(火) 15:00-16:00）
サービス: {サービス詳細}（例: アロママッサージ 60分）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）

キャンセルは48時間前まで可能です：
https://qualfia.com/phone/cancel/{予約ID}
```

**提携店へのリマインダー:**
```
【Qualfia予約代行】予約のリマインダーです。

予約ID: {予約ID}（例: QRV-A3F9D2）
日時: {予約日時}（2日後）（例: 1月28日(火) 15:00-16:00）
サービス: {サービス詳細}（例: アロママッサージ 60分）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）
お客様電話: {電話番号}
```

**第2回リマインダー（2時間前）:**

**依頼者へのリマインダー:**
```
【Qualfia予約代行】まもなく予約時間です。

予約ID: {予約ID}（例: QRV-A3F9D2）
日時: 本日 {時刻}（2時間後）（例: 15:00-16:00）
サービス: {サービス詳細}（例: アロママッサージ 60分）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）

担当者が直接お伺いします。
```

**提携店へのリマインダー:**
```
【Qualfia予約代行】まもなく予約時間です。

予約ID: {予約ID}（例: QRV-A3F9D2）
日時: 本日 {時刻}（2時間後）（例: 15:00-16:00）
サービス: {サービス詳細}（例: アロママッサージ 60分）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）
お客様電話: {電話番号}
```

**実装:**
- Celery Beatで定期実行（例: 毎時0分）
- 予約日時の48時間前・2時間前に該当する予約を抽出
- SMS送信（リトライ3回、失敗時はログ記録のみ）

---

### 4.2 Email通知

**機能概要:**
- 提携店にEmail通知（SMSの補助）

**送信タイミング:**
- 仮予約成功時
- 決済完了時
- 予約解放時
- キャンセル時

**内容:**
- SMSと同等の情報をHTML形式で送信

---

## 5. 管理機能

### 5.1 管理画面（初期MVP）

**機能概要:**
- コマンドライン/ログファイルで確認

**確認項目:**
- 予約一覧（予約ID、依頼者電話番号、提携店、ステータス）
- 決済状況
- 提携店リスト
- システムログ

**将来実装予定:**
- Web管理画面（Streamlit等）

---

## 6. キャンセル機能

### 6.1 キャンセルポリシー

**原則:**
- 予約日時の48時間前まで: キャンセル可能（全額返金）
- 48時間前以降: キャンセル不可（返金なし）
- キャンセル期限は設定パラメータとして管理可能

**キャンセル方法:**
- 決済完了SMS内のキャンセルURLから実行
- キャンセルURL有効期限: 予約日時の48時間前まで

**キャンセルURL:**
- 形式: `https://qualfia.com/phone/cancel/{reservation_id}`
- 決済完了SMS、第1回リマインダー（48時間前）に含める

### 6.2 キャンセル処理フロー

**処理:**
1. 依頼者がキャンセルURLをクリック
2. キャンセル確認画面を表示
3. 依頼者が「キャンセルする」ボタン押下
4. 予約ステータスを「cancelled」に更新
5. Stripeで返金処理を実行
6. 依頼者・提携店に即座にSMS送信

**依頼者へのキャンセル完了SMS:**
```
【Qualfia予約代行】キャンセルが完了しました。

予約ID: {予約ID}（例: QRV-A3F9D2）
サービス: {サービス名}（例: アロママッサージ）
日時: {予約日時}（例: 1月28日(火) 15:00-16:00）
料金: {料金}円（全額返金）

返金処理は3-5営業日で完了します。
```

**提携店へのキャンセル通知SMS:**
```
【Qualfia予約代行】予約がキャンセルされました。

予約ID: {予約ID}（例: QRV-A3F9D2）
日時: {予約日時}（例: 1月28日(火) 15:00-16:00）
サービス: {サービス詳細}（例: アロママッサージ 60分）
住所: {住所}（例: 東京都渋谷区道玄坂1-2-3）

この時間枠は解放されました。
```

**提携店へのキャンセル通知Email:**
- SMS送信と同時にEmail送信
- 内容はSMSと同等

### 6.3 48時間前以降のキャンセル

**エラーメッセージ:**
```
【Qualfia予約代行】

予約ID: {予約ID}

キャンセル期限（48時間前）を過ぎているため、
キャンセルできません。

緊急の場合は以下にメール連絡してください：
inquiry@qualfia.com
```

**例外対応:**
- 緊急時のみ、inquiry@qualfia.com にメール連絡
- 現時点では手動対応

**将来実装予定:**
- 自動キャンセル処理（一定条件下）
- キャンセル料の段階的設定（48時間前: 無料、24時間前: 50%等）

---

## 7. データ暗号化機能

### 7.1 暗号化の目的

**目的:**
- データベース侵害時のデータ保護
- 予約処理に関わる全データの機密性確保
- コンプライアンス要件への対応

### 7.2 暗号化対象

**暗号化対象データ:**
- 予約処理に関わる全データ（11フィールド）
- 依頼者連絡先、予約詳細、取引情報、通話記録等

**詳細:**
- 暗号化対象フィールドの詳細リストは基本設計書を参照
- データは暗号化されたままデータベースに保存
- アプリケーション層で復号化して使用

### 7.3 暗号化方式の要件

**要件:**
- 対称暗号化方式を使用
- 業界標準の暗号化アルゴリズムを採用
- 改ざん検知機能を持つこと
- 暗号化キーは環境変数で管理

### 7.4 データ保持

**保持方針:**
- 暗号化されたデータは永続的に保存
- データ削除ポリシーは設けない
- 暗号化キーの安全な管理と定期的なローテーション

---

## 8. サービスタイプ管理機能

### 8.1 概要

本機能により、新しいサービスタイプをコード変更なしで追加できます。サービスタイプは設定ファイル（JSON）と提携店データ（CSV）で定義され、システムは動的にこれらを読み込んで動作します。

### 8.2 サービスタイプの構成要素

新規サービスを追加する際は、以下の要素を定義する必要があります。

**基本情報:**
- **サービスコード**: 5桁の番号（例: 00001）
- **サービス名（英語）**: システム内部での識別名（例: Aroma Massage）
- **表示名（日本語）**: 依頼者に表示する名称（例: アロママッサージ）
- **対応エリア**: サービスが対応可能な地域
- **受付期限**: 最短・最長の予約可能期間

**データ関連:**
- **提携店CSV**: `data/shops_{service_code}.csv`
- **固有項目定義**: サービス固有の確認項目（JSON Schema形式）
- **料金計算ロジック**: サービスごとの料金計算プログラムを実装

**対話・通信関連:**
- **確認項目とプロンプト**: AIが依頼者に確認する項目と質問文
- **電話スクリプトテンプレート**: 提携店への電話で伝える内容
- **確認メッセージテンプレート**: 予約内容の最終確認文言

---

### 8.3 ファイル構成

サービスタイプごとに以下のファイルを作成します。

```
project_root/
├── data/
│   ├── shops_00001.csv          # アロママッサージ提携店
│   ├── shops_00002.csv          # 胡蝶蘭配送提携店
│   └── ...
├── config/
│   ├── service_00001.json       # アロママッサージ定義
│   ├── service_00002.json       # 胡蝶蘭配送定義
│   └── ...
└── src/pricing/
    ├── pricing_00001.py         # アロママッサージ料金計算
    ├── pricing_00002.py         # 胡蝶蘭配送料金計算
    └── ...
```

**service_{code}.json の構造例:**
```json
{
  "service_code": "00001",
  "service_name": "Aroma Massage",
  "display_name": "アロママッサージ",
  "service_area": "東京23区",
  "booking_window": {
    "min_hours_ahead": 24,
    "max_days_ahead": 30
  },
  "required_fields": [...],
  "optional_fields": [...],
  "phone_script_template": "...",
  "confirmation_template": "..."
}
```

---

### 8.4 料金計算の実装

各サービスタイプごとに料金計算ロジックを個別に実装します。

**実装方針:**
- `src/pricing/pricing_{service_code}.py` として実装
- 共通インターフェース `calculate_price(reservation_data) -> int` を実装
- サービスごとに異なるロジックを自由に実装可能

**実装例:**
```python
# src/pricing/pricing_00001.py
def calculate_price(reservation_data):
    """アロママッサージの料金計算"""
    base_price = 1000
    duration = reservation_data['preferred_duration']
    start_time = reservation_data['start_time']

    # 時間帯による料金変動ロジック
    # ...

    return total_price
```

---

### 8.5 電話スクリプトの設計

**基本構造:**
1. **Opening（全サービス共通）**: 2.2で定義済み
2. **Requirements（サービス固有）**: 必要情報を伝達
3. **Confirmation（サービス固有）**: 予約内容を確認

**設計ポイント:**
- 必要最小限の情報のみ伝達
- 依頼者の連絡先以外の情報（氏名、年齢、性別等）は伝えない
- 予約に必要な情報: 日時、場所、サービス内容、依頼者電話番号のみ
- 追加情報が必要な場合は、提携店が依頼者と直接確認

**テンプレート変数の例:**
- `{date}`: 予約日
- `{time_range}`: 時間帯
- `{preferred_duration}`: 希望時間
- `{fallback_duration}`: 代替時間
- `{address}`: 住所
- `{product_option}`: 商品オプション（サイズ、種類、プラン等）
- `{custom_message}`: カスタマイズメッセージ（立て札、熨斗等）

**外部設計時の重要な注意点:**

音声AI（Bland.ai等）を使用した提携店との電話対応において、以下の点に注意が必要です。

1. **柔軟な会話フロー**: サンプルスクリプト通りに提携店が回答しない場合でも、音声AIが柔軟に会話を継続できるよう設計すること
2. **想定外の応答への対応**: 提携店が質問で返答した場合、予想外の情報を追加した場合でも、必要情報を確実に収集できること
3. **中断・再開の処理**: 提携店が「少々お待ちください」と言って保留にした場合の処理
4. **理解確認の実施**: 重要な情報（日時、場所等）は提携店に復唱確認を求めること

---

### 8.6 バリデーションルールの定義

**共通バリデーション:**
- 電話番号: 携帯電話番号（080/090/070で始まる11桁）

**サービス固有バリデーション例:**
- 時間制サービス:
  - 受注単位: サービスごとに定義（例: 10分刻み）
  - 最小時間: サービスごとに定義（例: 40分）
  - 最大時間: サービスごとに定義（例: 120分）
- サイズオーダー型:
  - サイズ選択: 定義されたサイズのみ
  - 数量: 1固定（複数注文は別予約）

**エラーメッセージ:**
- バリデーションエラー時は、依頼者に具体的な修正方法を提示

---

### 8.7 サービス追加手順

新規サービスを追加する際は、以下の手順で実施してください。

#### 8.7.1 基本情報の定義

- [ ] **サービスコード**: 5桁の一意なコード
- [ ] **サービス名**: 英語名（システム内部用）、日本語名（ユーザー表示用）
- [ ] **対応エリア**: サービス提供可能な地域
- [ ] **受付期限**: 最短何時間前、最長何日先まで予約可能か

#### 8.7.2 料金計算の実装

- [ ] **料金計算ロジック**: `src/pricing/pricing_{code}.py` を実装
- [ ] **計算単位**: 料金計算の最小単位と、顧客に提示する受注単位

#### 8.7.3 確認項目の定義

**共通必須項目**（全サービス）:
- [ ] `customer_phone`: 連絡先電話番号

**サービス固有項目**:
- [ ] 配送先/派遣先住所の項目名（例: `delivery_address`）
- [ ] 日時項目（例: `preferred_date`, `time_range`）
- [ ] サービス固有の必須項目（例: `preferred_duration`, `product_option`）
- [ ] サービス固有の任意項目（例: `fallback_duration`, `custom_message`）

#### 8.7.4 電話スクリプトの定義

- [ ] **Requirements部分のテンプレート**: 提携店に伝える必要情報
- [ ] **Confirmation部分のテンプレート**: 提携店の回答確認
- [ ] **使用する変数**: `{date}`, `{address}`, `{product_option}` 等

**スクリプトテンプレート例**:
```
{date}の{time_range}で、{service_details}をお願いしたいのですが、
場所は{address}です。ご対応可能でしょうか？
```

#### 8.7.5 提携店データの準備

- [ ] **提携店CSV**: `data/shops_{service_code}.csv` を作成
- [ ] **最低店舗数**: 5店舗以上推奨
- [ ] **必須カラム**: shop_id, service_type, shop_name, phone_number, email, supported_areas, score, phone_reception_start, phone_reception_end

#### 8.7.6 その他の考慮事項

- [ ] **代替案の扱い**: 時間変更、商品変更等の方針
- [ ] **バリデーションルール**: 入力値の制約
- [ ] **SMSテンプレート**: カスタマイズが必要な場合
- [ ] **テストデータ**: 正常系・異常系のテストケース

---

**参考**: サービスタイプの具体例は、[2_sample_data](2_sample_data/) ディレクトリのサンプルデータを参照してください。

---

**文書終了**
